# Dev Log: 2025-10-30 12:57

## /next Page Bug Fix & Dev Infrastructure

### Bug: In-Progress Event Detection

**Problem:** `/next` page showed slots during current events (should be blocked)

**Root Cause:** `getNextUpcomingEvent.ts` only checked `isAfter()`, missing in-progress events

**Fix:** Added `isInProgress` condition checking start <= now && end > now

**Files:** `lib/fetch/getNextUpcomingEvent.ts`, test file, `scripts/debugNextPage.ts`

**Commits:** `060d685`, `3e0293b`

---

### Dev Infrastructure: Excluding Folders from Production

**Learning: How to exclude dev-only code from production builds**

**Pattern created:** `app/api/dev-mode-prod-excluded/`

**Exclusion method:** Webpack `ignore-loader`

- Configure in `next.config.js`
- Test regex pattern against file paths
- Only applies in production builds (`!options.dev`)

**Multi-layer safety:**

- Webpack ignore-loader (primary exclusion)
- NODE_ENV checks in route handlers (runtime safety)
- Dynamic imports for utilities (code-splitting)
- Environment variable gates (CAPTURE_TEST_DATA)

**Bundling rules learned:**

- `/scripts/` never bundled (source files only)
- `/lib/` conditionally bundled (only if imported by app code)
- `/app/api/` always bundled UNLESS excluded by webpack config

**Files created:**

- `app/api/dev-mode-prod-excluded/capture-test-data/route.ts` - API endpoint
- `lib/utils/captureTestData.ts` - Utilities (dynamically imported)
- `scripts/capture-test-data.mjs` - CLI tool
- `next.config.js` - Webpack ignore rule

**Usage:**

- API: `/api/dev-mode-prod-excluded/capture-test-data`
- CLI: `node scripts/capture-test-data.mjs` (interactive mode)
- Debug: `npx tsx scripts/debugNextPage.ts`

**Commits:** `232bdde`, `c348015`

---

### Cleanup

**Removed duplicate snapshot system** - API-based approach more flexible

**TypeScript fix:** Type guard needed `typeof obj === 'object' && obj !== null` for Object.keys()

---

### Key Takeaways

1. **Exclude folders from prod:** Use webpack ignore-loader + folder naming pattern
2. **Defense in depth:** Multiple exclusion layers prevent accidental prod deployment
3. **Dynamic imports:** Help but don't prevent bundling - file still ships if statically imported
4. **Folder conventions:** Explicit naming (`dev-mode-prod-excluded`) prevents confusion
